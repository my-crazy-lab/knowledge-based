# DDD Trong Thá»±c Táº¿: KhÃ´ng pháº£i "giáº¥c mÆ¡ phÃ²ng lab"

- Äa pháº§n dá»± Ã¡n báº¡n lÃ m sáº½ lÃ  brownfield (dá»± Ã¡n cÅ©, code legacy, technical debt Ä‘áº§y mÃ¬nh).
- ChÃ­nh nhá»¯ng dá»± Ã¡n nÃ y má»›i cáº§n DDD nháº¥t â€“ Ä‘á»ƒ gá»¡ rá»‘i, phá»¥c há»“i domain knowledge, vÃ  tá»• chá»©c láº¡i há»‡ thá»‘ng.

## Checklist Ãp Dá»¥ng DDD Trong Dá»± Ãn Legacy

| Viá»‡c cáº§n lÃ m                     | CÃ´ng cá»¥                                      |
|----------------------------------|----------------------------------------------|
| Hiá»ƒu chiáº¿n lÆ°á»£c vÃ  domain        | Phá»ng váº¥n stakeholders, org chart            |
| PhÃ¢n loáº¡i subdomain              | Core / Supporting / Generic                  |
| Dá»±ng sÆ¡ Ä‘á»“ thÃ nh pháº§n hiá»‡n táº¡i   | Context mapping                              |
| ÄÃ¡nh giÃ¡ codebase hiá»‡n táº¡i       | Xem pattern cÃ³ phÃ¹ há»£p khÃ´ng                 |
| Tá»• chá»©c EventStorming            | KhÃ´i phá»¥c logic & thiáº¿t láº­p language         |
| Báº¯t Ä‘áº§u nhá»                      | Refactor má»™t subdomain nhá» trÆ°á»›c             |

## Modernization Strategy

- Nhá»¯ng ná»— lá»±c **viáº¿t láº¡i toÃ n bá»™** há»‡ thá»‘ng tá»« Ä‘áº§u â€“ vá»›i ká»³ vá»ng láº§n nÃ y sáº½ thiáº¿t káº¿ vÃ  triá»ƒn khai má»i thá»© má»™t cÃ¡ch Ä‘Ãºng Ä‘áº¯n â€“ hiáº¿m khi thÃ nh cÃ´ng
- **Modernization Strategy** lÃ  dáº¡ng refactor an toÃ n, vÃ¬ khÃ´ng Ä‘á»¥ng Ä‘áº¿n logic nghiá»‡p vá»¥, chá»‰ sáº¯p xáº¿p láº¡i mÃ£ nguá»“n há»£p lÃ½ hÆ¡n

## Tactical Modernization

- tÃ¬m nhá»¯ng pháº§n gÃ¢y **Ä‘au Ä‘á»›n** nháº¥t â€“ nÆ¡i **giÃ¡ trá»‹ nghiá»‡p vá»¥ cao** nhÆ°ng **thiáº¿t káº¿ ká»¹ thuáº­t kÃ©m**

## Ubiquitous Language

- Má»™t Ä‘iá»u kiá»‡n quan trá»ng Ä‘á»ƒ hiá»‡n Ä‘áº¡i hÃ³a thÃ nh cÃ´ng lÃ  kiáº¿n thá»©c domain pháº£i rÃµ rÃ ng, vÃ  cÃ³ mÃ´ hÃ¬nh thá»ƒ hiá»‡n chÃ­nh xÃ¡c -> **EventStorming**

## Strangler Pattern

- lÃ  má»™t loÃ i cÃ¢y nhiá»‡t Ä‘á»›i cÃ³ cÃ¡ch sinh trÆ°á»Ÿng Ä‘áº·c biá»‡t: chÃºng má»c bÃ¡m vÃ o thÃ¢n cÃ¢y khÃ¡c â€“ cÃ¢y chá»§. Háº¡t giá»‘ng báº¯t Ä‘áº§u náº£y máº§m á»Ÿ tÃ¡n cÃ¢y chá»§, rá»“i má»c rá»… dáº§n xuá»‘ng Ä‘áº¥t. Khi Ä‘Ã£ bÃ©n rá»…, cÃ¢y strangler tiáº¿p tá»¥c phÃ¡t triá»ƒn, tÃ¡n lÃ¡ cá»§a nÃ³ che khuáº¥t cÃ¢y chá»§ â€“ cuá»‘i cÃ¹ng khiáº¿n cÃ¢y chá»§ cháº¿t dáº§n.
- **Strangler Pattern** láº¥y cáº£m há»©ng tá»« quy luáº­t sinh trÆ°á»Ÿng Ä‘Ã³
    - Táº¡o má»™t bounded context má»›i â€“ gá»i lÃ  `strangler`.
    - Sá»­ dá»¥ng nÃ³ Ä‘á»ƒ triá»ƒn khai cÃ¡c yÃªu cáº§u má»›i.
    - Dáº§n dáº§n di chuyá»ƒn logic cÅ© tá»« há»‡ thá»‘ng legacy sang bounded context má»›i.
    - Trong quÃ¡ trÃ¬nh Ä‘Ã³, dá»«ng phÃ¡t triá»ƒn há»‡ thá»‘ng cÅ© (trá»« cÃ¡c hotfix kháº©n cáº¥p).
- Khi toÃ n bá»™ chá»©c nÄƒng Ä‘Ã£ Ä‘Æ°á»£c chuyá»ƒn sang bounded context má»›i, há»‡ thá»‘ng cÅ© cÃ³ thá»ƒ bá»‹ *khai tá»­* â€“ giá»‘ng nhÆ° cÃ¢y chá»§ bá»‹ cÃ¢y strangler lÃ m cháº¿t dáº§n.
- Máº«u Strangler thÆ°á»ng Ä‘i kÃ¨m vá»›i FaÃ§ade Pattern â€“ má»™t lá»›p trá»«u tÆ°á»£ng má»ng, Ä‘á»©ng ra nháº­n yÃªu cáº§u vÃ  chuyá»ƒn tiáº¿p sang há»‡ thá»‘ng má»›i hoáº·c cÅ© tÃ¹y theo chá»©c nÄƒng Ä‘Ã£ Ä‘Æ°á»£c migrate hay chÆ°a.
- database dÃ¹ng chung chá»‰ lÃ  táº¡m thá»i, vÃ  pháº£i Ä‘Æ°á»£c tÃ¡ch riÃªng khi há»‡ thá»‘ng cÅ© Ä‘Ã£ bá»‹ loáº¡i bá».

`HÃ£y nhá»›: DDD khÃ´ng pháº£i chá»‰ lÃ  aggregates hay value objects.
ğŸ‘‰ DDD lÃ  Ä‘á»ƒ domain nghiá»‡p vá»¥ dáº«n dáº¯t cÃ¡c quyáº¿t Ä‘á»‹nh thiáº¿t káº¿ pháº§n má»m.`

# Microservices

- má»‘i quan há»‡ giá»¯a microservices vÃ  bounded contexts khÃ´ng pháº£i lÃ  Ä‘á»‘i xá»©ng. Máº·c dÃ¹ microservices lÃ  bounded contexts, khÃ´ng pháº£i má»i bounded context Ä‘á»u lÃ  microservice.
- Trong khi bounded contexts Ä‘áº·t giá»›i háº¡n cho cÃ¡c ranh giá»›i lá»›n nháº¥t há»£p lá»‡, máº«u aggregate lÃ m Ä‘iá»u ngÆ°á»£c láº¡i. Ranh giá»›i cá»§a aggregate lÃ  ranh giá»›i háº¹p nháº¥t cÃ³ thá»ƒ
    - microservices khÃ´ng pháº£i vá» cÃ¡c dá»‹ch vá»¥ cÃ¡ nhÃ¢n. Má»™t dá»‹ch vá»¥ cÃ¡ nhÃ¢n pháº£i Ä‘Æ°á»£c xem xÃ©t trong ngá»¯ cáº£nh cá»§a cÃ¡c tÆ°Æ¡ng tÃ¡c vá»›i cÃ¡c thÃ nh pháº§n khÃ¡c trong há»‡ thá»‘ng
    - Sáº½ cÃ³ nhá»¯ng trÆ°á»ng há»£p trong Ä‘Ã³ viá»‡c cÃ³ má»™t aggregate nhÆ° má»™t dá»‹ch vá»¥ sáº½ táº¡o ra má»™t **module**. Tuy nhiÃªn, thÆ°á»ng xuyÃªn hÆ¡n, cÃ¡c dá»‹ch vá»¥ chi tiáº¿t nhÆ° váº­y sáº½ lÃ m tÄƒng Ä‘á»™ phá»©c táº¡p toÃ n cáº§u cá»§a há»‡ thá»‘ng.
- subdomains trá»Ÿ thÃ nh má»™t ranh giá»›i an toÃ n Ä‘á»ƒ thiáº¿t káº¿ microservices.

# Event driven architecture

- Máº·c dÃ¹ cáº£ kiáº¿n trÃºc dá»±a trÃªn *event* vÃ  event sourcing Ä‘á»u dá»±a trÃªn *event*, nhÆ°ng hai máº«u thiáº¿t káº¿ nÃ y lÃ  khÃ¡c biá»‡t vá» máº·t khÃ¡i niá»‡m. EDA liÃªn quan Ä‘áº¿n giao tiáº¿p giá»¯a cÃ¡c dá»‹ch vá»¥, trong khi event sourcing xáº£y ra bÃªn trong má»™t dá»‹ch vá»¥
    - Má»™t event schema Ä‘iá»ƒn hÃ¬nh bao gá»“m metadata cá»§a sá»± kiá»‡n vÃ  payload cá»§a nÃ³
    - Payload cá»§a má»™t *event* khÃ´ng chá»‰ mÃ´ táº£ thÃ´ng tin Ä‘Æ°á»£c truyá»n táº£i bá»Ÿi *event* mÃ  cÃ²n xÃ¡c Ä‘á»‹nh loáº¡i *event* Ä‘Ã³

## Type of event

- **Event Notification**
    - ThÃ´ng bÃ¡o *event* nÃªn ngáº¯n gá»n: má»¥c tiÃªu lÃ  thÃ´ng bÃ¡o cho cÃ¡c bÃªn quan tÃ¢m vá» *event*, nhÆ°ng khÃ´ng nÃªn truyá»n táº£i táº¥t cáº£ thÃ´ng tin cáº§n thiáº¿t Ä‘á»ƒ cÃ¡c bÃªn Ä‘Ã³ pháº£n há»“i
    - Khi nÃ o nÃªn dÃ¹ng
        - *Security*: VÃ¬ ngÆ°á»i nháº­n pháº£i chá»§ Ä‘á»™ng truy váº¥n dá»¯ liá»‡u, nÃªn cÃ³ thá»ƒ kiá»ƒm soÃ¡t quyá»n truy cáº­p vÃ o thÃ´ng tin nháº¡y cáº£m
        - *Concurrency*: 
            - dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘Ã£ lá»—i thá»i khi Ä‘áº¿n tay ngÆ°á»i nháº­n. YÃªu cáº§u ngÆ°á»i nháº­n truy váº¥n láº¡i giÃºp Ä‘áº£m báº£o láº¥y dá»¯ liá»‡u má»›i nháº¥t. 
            - cÃ³ thá»ƒ dÃ¹ng thÃªm *pessimistic locking* Ä‘á»ƒ Ä‘áº£m báº£o chá»‰ má»™t consumer xá»­ lÃ½ *event*.
- **Event-Carried State Transfer** - ECST
    - ThÃ´ng Ä‘iá»‡p ECST thÃ´ng bÃ¡o vá» thay Ä‘á»•i trong tráº¡ng thÃ¡i ná»™i bá»™ cá»§a nhÃ  sáº£n xuáº¥t (producer). KhÃ´ng giá»‘ng event notification, ECST chá»©a Ä‘áº§y Ä‘á»§ dá»¯ liá»‡u mÃ´ táº£ thay Ä‘á»•i.
    - Vá» máº·t khÃ¡i niá»‡m, Ä‘Ã¢y lÃ  má»™t cÆ¡ cháº¿ Ä‘á»“ng bá»™ hÃ³a dá»¯ liá»‡u báº¥t Ä‘á»“ng bá»™ giá»¯a producer vÃ  consumer.
    - TÄƒng kháº£ nÄƒng chá»‹u lá»—i: consumer cÃ³ thá»ƒ tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng ngay cáº£ khi producer khÃ´ng sáºµn sÃ ng.
    - Cáº£i thiá»‡n hiá»‡u nÄƒng: thay vÃ¬ pháº£i truy váº¥n liÃªn tá»¥c, dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c cache cá»¥c bá»™.
- **Domain Event**
    - domain event náº±m giá»¯a event notification vÃ  ECST: nÃ³ mÃ´ táº£ má»™t *event* quan trá»ng trong nghiá»‡p vá»¥ vÃ  chá»©a táº¥t cáº£ dá»¯ liá»‡u mÃ´ táº£ *event* Ä‘Ã³.
    - Domain event chá»©a Ä‘áº§y Ä‘á»§ thÃ´ng tin. KhÃ´ng cáº§n hÃ nh Ä‘á»™ng thÃªm tá»« consumer.
    - Trong há»‡ thá»‘ng event-sourced, domain event lÃ  trung tÃ¢m Ä‘á»ƒ mÃ´ hÃ¬nh hÃ³a táº¥t cáº£ tráº¡ng thÃ¡i, chá»© khÃ´ng chá»‰ Ä‘á»ƒ tÃ­ch há»£p. Viá»‡c buá»™c má»i domain event pháº£i cÃ³ subscriber sáº½ dáº«n Ä‘áº¿n thiáº¿t káº¿ kÃ©m tá»‘i Æ°u.
- Lá»±a chá»n Ä‘Ãºng loáº¡i *event* (Event Type)
    - Event Notification
        - Báº¡n muá»‘n thÃ´ng bÃ¡o cho cÃ¡c thÃ nh pháº§n khÃ¡c ráº±ng má»™t *event* kinh doanh Ä‘Ã£ xáº£y ra mÃ  khÃ´ng tiáº¿t lá»™ tráº¡ng thÃ¡i ná»™i bá»™.
        - Consumer (bÃªn tiÃªu thá»¥) cÃ³ thá»ƒ vÃ  nÃªn tá»± láº¥y dá»¯ liá»‡u Ä‘áº§y Ä‘á»§ tá»« há»‡ thá»‘ng nguá»“n dá»±a vÃ o thÃ´ng tin trong *event*.
        - CÃ³ nhá»¯ng lo ngáº¡i vá» báº£o máº­t hoáº·c tÃ­nh thá»i Ä‘iá»ƒm (vÃ­ dá»¥, dá»¯ liá»‡u cÃ³ thá»ƒ lá»—i thá»i hoáº·c nháº¡y cáº£m).
        - Há»‡ thá»‘ng phÃ¡t hÃ nh *event* muá»‘n áº©n chi tiáº¿t ná»™i bá»™ vá»›i cÃ¡c há»‡ thá»‘ng khÃ¡c.
        - Æ¯u Ä‘iá»ƒm:
            - Payload (ná»™i dung thÃ´ng bÃ¡o) nháº¹.
            - TÄƒng cÆ°á»ng phÃ¢n tÃ¡ch trÃ¡ch nhiá»‡m giá»¯a cÃ¡c há»‡ thá»‘ng.
            - Giáº£m thiá»ƒu rÃ² rá»‰ thÃ´ng tin nháº¡y cáº£m.
        - NhÆ°á»£c Ä‘iá»ƒm:
            - Consumer pháº£i thá»±c hiá»‡n thÃªm má»™t bÆ°á»›c gá»i Ä‘áº¿n há»‡ thá»‘ng khÃ¡c Ä‘á»ƒ láº¥y thÃ´ng tin.
            - CÃ³ thá»ƒ tÄƒng Ä‘á»™ trá»… hoáº·c lÃ m há»‡ thá»‘ng dá»… gáº·p lá»—i hÆ¡n (náº¿u viá»‡c truy xuáº¥t tháº¥t báº¡i).
    - Event-Carried State Transfer - ECST
        - CÃ¡c consumer cáº§n tráº¡ng thÃ¡i hiá»‡n táº¡i Ä‘á»ƒ xá»­ lÃ½ vÃ  báº¡n muá»‘n trÃ¡nh gá»i API tá»« xa.
        - Báº¡n Ä‘ang xÃ¢y dá»±ng cache cá»¥c bá»™ Ä‘á»ƒ tÄƒng hiá»‡u nÄƒng hoáº·c há»— trá»£ hoáº¡t Ä‘á»™ng offline.
        - Cáº§n Ä‘á»“ng bá»™ hÃ³a tráº¡ng thÃ¡i má»™t cÃ¡ch báº¥t Ä‘á»“ng bá»™ giá»¯a cÃ¡c dá»‹ch vá»¥.
        - Æ¯u Ä‘iá»ƒm:
            - Consumer cÃ³ thá»ƒ tá»± xá»­ lÃ½ mÃ  khÃ´ng cáº§n truy cáº­p há»‡ thá»‘ng khÃ¡c.
            - PhÃ¹ há»£p vá»›i cÃ¡c há»‡ thá»‘ng Ä‘á»c nhiá»u dá»¯ liá»‡u (vÃ­ dá»¥ nhÆ° backend cho frontend).
            - GiÃºp há»‡ thá»‘ng resilient (chá»‹u lá»—i tá»‘t) náº¿u há»‡ thá»‘ng nguá»“n khÃ´ng kháº£ dá»¥ng.
        - NhÆ°á»£c Ä‘iá»ƒm:
            - Schema (cáº¥u trÃºc dá»¯ liá»‡u) thay Ä‘á»•i dá»… gÃ¢y lá»—i cho consumer.
            - CÃ³ thá»ƒ tiáº¿t lá»™ quÃ¡ nhiá»u thÃ´ng tin ná»™i bá»™.
            - Cáº§n quáº£n lÃ½ versioning (phiÃªn báº£n) cáº©n tháº­n.
    - Domain Event
        - Báº¡n muá»‘n mÃ´ hÃ¬nh hÃ³a hÃ nh vi nghiá»‡p vá»¥, khÃ´ng pháº£i tráº¡ng thÃ¡i.
        - Báº¡n cáº§n ghi nháº­n nhá»¯ng khoáº£nh kháº¯c quan trá»ng trong domain, ká»ƒ cáº£ khi khÃ´ng cÃ³ ai tiÃªu thá»¥ chÃºng.
        - Báº¡n Ä‘ang sá»­ dá»¥ng event sourcing, nÆ¡i cÃ¡c *event* lÃ  nguá»“n gá»‘c cá»§a tráº¡ng thÃ¡i há»‡ thá»‘ng.
- Chá»‰ nhá»¯ng káº» hoang tÆ°á»Ÿng má»›i sá»‘ng sÃ³t.
    - Máº¡ng sáº½ cháº­m.
    - MÃ¡y chá»§ sáº½ há»ng vÃ o Ä‘Ãºng thá»i Ä‘iá»ƒm tá»“i tá»‡ nháº¥t.
    - *event* sáº½ Ä‘áº¿n sai thá»© tá»±.
    - *event* sáº½ bá»‹ trÃ¹ng láº·p.
    - VÃ  quan trá»ng hÆ¡n háº¿t: nhá»¯ng Ä‘iá»u nÃ y thÆ°á»ng xáº£y ra vÃ o cuá»‘i tuáº§n hoáº·c ngÃ y lá»….
- Tá»« *driven* trong kiáº¿n trÃºc *event-driven* cÃ³ nghÄ©a lÃ  toÃ n bá»™ há»‡ thá»‘ng phá»¥ thuá»™c vÃ o viá»‡c cÃ¡c thÃ´ng Ä‘iá»‡p (messages) Ä‘Æ°á»£c gá»­i Ä‘i thÃ nh cÃ´ng. VÃ¬ váº­y, hÃ£y trÃ¡nh xa tÆ° duy *má»i thá»© sáº½ á»•n thÃ´i*.
- PhÃ¢n biá»‡t rÃµ giá»¯a *event* cÃ´ng khai (public) vÃ  *event* riÃªng tÆ° (private)
- ÄÃ¡nh giÃ¡ yÃªu cáº§u vá» tÃ­nh nháº¥t quÃ¡n (consistency)
    - Náº¿u cÃ¡c thÃ nh pháº§n cÃ³ thá»ƒ cháº¥p nháº­n dá»¯ liá»‡u nháº¥t quÃ¡n sau má»™t khoáº£ng thá»i gian (eventual consistency), hÃ£y sá»­ dá»¥ng event-carried state transfer.
    - Náº¿u consumer cáº§n Ä‘á»c tráº¡ng thÃ¡i má»›i nháº¥t vá»«a Ä‘Æ°á»£c ghi cá»§a producer, hÃ£y phÃ¡t hÃ nh event notification kÃ¨m theo má»™t truy váº¥n (query) Ä‘áº¿n producer Ä‘á»ƒ láº¥y tráº¡ng thÃ¡i cáº­p nháº­t nháº¥t.

# Data mesh

- CÅ©ng giá»‘ng nhÆ° domain events, dá»¯ liá»‡u phÃ¢n tÃ­ch lÃ  dáº¡ng chá»‰-ghi (append-only): khÃ´ng cÃ³ xoÃ¡ hay chá»‰nh sá»­a. CÃ¡ch duy nháº¥t Ä‘á»ƒ thá»ƒ hiá»‡n ráº±ng má»™t báº£n ghi Ä‘Ã£ lá»—i thá»i lÃ  thÃªm má»™t báº£n ghi má»›i vá»›i tráº¡ng thÃ¡i hiá»‡n táº¡i.
- Má»™t Ä‘iá»ƒm khÃ¡c biá»‡t lá»›n ná»¯a giá»¯a OLAP vÃ  OLTP lÃ  **Ä‘á»™ chi tiáº¿t cá»§a dá»¯ liá»‡u**:
    - Há»‡ thá»‘ng váº­n hÃ nh (OLTP) yÃªu cáº§u dá»¯ liá»‡u pháº£i ráº¥t chi tiáº¿t Ä‘á»ƒ xá»­ lÃ½ cÃ¡c giao dá»‹ch.
    - Trong khi Ä‘Ã³, mÃ´ hÃ¬nh phÃ¢n tÃ­ch thÆ°á»ng sá»­ dá»¥ng dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c tá»•ng há»£p (aggregated) nháº±m phá»¥c vá»¥ cÃ¡c tÃ¬nh huá»‘ng sá»­ dá»¥ng hiá»‡u quáº£ hÆ¡n.
- snowflake schema
    - cÃ¡c dimension Ä‘Æ°á»£c chuáº©n hoÃ¡ thÃªm thÃ nh nhiá»u cáº¥p
    - Viá»‡c chuáº©n hoÃ¡ thÃªm nÃ y giÃºp mÃ´ hÃ¬nh tiáº¿t kiá»‡m khÃ´ng gian lÆ°u trá»¯ hÆ¡n vÃ  dá»… báº£o trÃ¬ hÆ¡n. 
    - Tuy nhiÃªn, Ä‘á»ƒ truy váº¥n dá»¯ liá»‡u tá»« fact sáº½ cáº§n ná»‘i (join) nhiá»u báº£ng hÆ¡n, dáº«n Ä‘áº¿n viá»‡c tiÃªu tá»‘n nhiá»u tÃ i nguyÃªn tÃ­nh toÃ¡n hÆ¡n.
- Data lake cÃ³ thá»ƒ trá»Ÿ thÃ nh **data swamp** (Ä‘áº§m láº§y dá»¯ liá»‡u).